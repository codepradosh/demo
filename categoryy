#!/usr/bin/env python3
"""
RAW CSV Cleaner - Reads file as text, not pandas
"""

import sys

if len(sys.argv) < 3:
    print("Usage: python clean_raw.py input.csv output.csv")
    sys.exit(1)

input_file = sys.argv[1]
output_file = sys.argv[2]

print("=" * 60)
print("ðŸ§¹ RAW CSV CLEANER (Text-based)")
print("=" * 60)
print(f"Input:  {input_file}")
print(f"Output: {output_file}")

# Read as raw text
print("\nðŸ“– Reading file as raw text...")
with open(input_file, 'r', encoding='utf-8', errors='replace') as f:
    lines = f.readlines()

total_lines = len(lines)
print(f"   Total lines: {total_lines:,}")

# Show first 10 lines
print("\nðŸ” First 10 lines:")
for i, line in enumerate(lines[:10]):
    print(f"   Line {i}: {line[:80].strip()}...")

# Show last 10 lines
print("\nðŸ” Last 10 lines:")
for i, line in enumerate(lines[-10:], start=total_lines-10):
    print(f"   Line {i}: {line[:80].strip()}...")

# Keep only lines that start with "INC" (after the header)
print("\nðŸ” Filtering lines...")

header = lines[0]  # Keep header
valid_lines = [header]
invalid_count = 0
invalid_examples = []

for i, line in enumerate(lines[1:], start=1):
    # Get first field (before first comma)
    first_field = line.split(',')[0].strip()
    
    # Check if it starts with INC
    if first_field.startswith('INC'):
        valid_lines.append(line)
    else:
        invalid_count += 1
        if len(invalid_examples) < 20:
            invalid_examples.append(f"Line {i}: {first_field[:60]}")

print(f"\nâŒ Found {invalid_count:,} INVALID lines")
if invalid_examples:
    print("   Examples of invalid first fields:")
    for ex in invalid_examples:
        print(f"      {ex}")

print(f"\nâœ… Valid lines: {len(valid_lines):,} (including header)")

# Write output
print(f"\nðŸ’¾ Saving to {output_file}...")
with open(output_file, 'w', encoding='utf-8') as f:
    f.writelines(valid_lines)

print("\n" + "=" * 60)
print("ðŸ“Š SUMMARY")
print("=" * 60)
print(f"   Original lines: {total_lines:,}")
print(f"   Invalid removed: {invalid_count:,}")
print(f"   Final lines: {len(valid_lines):,}")
print("âœ… DONE!")
