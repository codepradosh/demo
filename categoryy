#!/usr/bin/env python3
"""
CSV Cleaner Script
Removes rows where Cluster Group is empty.

Usage:
    python clean_csv.py input.csv output.csv
"""

import pandas as pd
import argparse
import sys
from pathlib import Path


def main():
    parser = argparse.ArgumentParser(description='Clean CSV - Remove rows with empty Cluster Group')
    parser.add_argument('input_csv', help='Path to input CSV file')
    parser.add_argument('output_csv', help='Path to output CSV file')
    
    args = parser.parse_args()
    
    # Check input file exists
    input_path = Path(args.input_csv)
    if not input_path.exists():
        print(f"âŒ Error: Input file not found: {args.input_csv}")
        sys.exit(1)
    
    print("=" * 60)
    print("ğŸ§¹ CSV CLEANER - Remove Empty Cluster Group")
    print("=" * 60)
    print(f"ğŸ“‚ Input:  {args.input_csv}")
    print(f"ğŸ“‚ Output: {args.output_csv}")
    print("")
    
    # Load CSV
    print("ğŸ“– Loading CSV...")
    try:
        df = pd.read_csv(args.input_csv)
        initial_rows = len(df)
        print(f"   Loaded {initial_rows:,} rows, {len(df.columns)} columns")
    except Exception as e:
        print(f"âŒ Error loading CSV: {e}")
        sys.exit(1)
    
    # Find Cluster Group column (handle different naming)
    cluster_col = None
    if 'Cluster Group' in df.columns:
        cluster_col = 'Cluster Group'
    elif 'cluster_group' in df.columns:
        cluster_col = 'cluster_group'
    elif 'CLUSTER_GROUP' in df.columns:
        cluster_col = 'CLUSTER_GROUP'
    
    if not cluster_col:
        print(f"âŒ Error: 'Cluster Group' column not found!")
        print(f"   Available columns: {df.columns.tolist()}")
        sys.exit(1)
    
    print(f"\nğŸ” Removing rows where '{cluster_col}' is empty...")
    
    # Remove rows where Cluster Group is empty (NaN or empty string)
    mask = df[cluster_col].notna() & (df[cluster_col].astype(str).str.strip() != '')
    df_cleaned = df[mask].copy()
    
    rows_removed = initial_rows - len(df_cleaned)
    print(f"   âœ… Removed {rows_removed:,} rows with empty Cluster Group")
    
    # Save output
    print(f"\nğŸ’¾ Saving cleaned CSV...")
    try:
        df_cleaned.to_csv(args.output_csv, index=False, encoding='utf-8')
        print(f"   âœ… Saved to: {args.output_csv}")
    except Exception as e:
        print(f"âŒ Error saving CSV: {e}")
        sys.exit(1)
    
    # Summary
    print("\n" + "=" * 60)
    print("ğŸ“Š SUMMARY")
    print("=" * 60)
    print(f"   Original rows:  {initial_rows:,}")
    print(f"   Rows removed:   {rows_removed:,}")
    print(f"   Final rows:     {len(df_cleaned):,}")
    print("âœ… Done!")


if __name__ == "__main__":
    main()
