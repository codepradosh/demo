#!/usr/bin/env python3
"""
Search for a specific value in CSV and display full row details
"""

import pandas as pd
import sys

# Load CSV
csv_file = "./output/incidents_categorized_20260117_042526.csv"
search_value = "d-3735"

print(f"üîç Searching for '{search_value}' in {csv_file}...")
print("=" * 80)

df = pd.read_csv(csv_file, low_memory=False)
print(f"Loaded {len(df):,} rows, {len(df.columns)} columns\n")

# Search in incident_number column
if 'incident_number' in df.columns:
    matches = df[df['incident_number'].astype(str).str.contains(search_value, case=False, na=False)]
    
    if len(matches) > 0:
        print(f"‚úÖ Found {len(matches)} row(s) matching '{search_value}':\n")
        
        for idx, row in matches.iterrows():
            print(f"Row Index: {idx}")
            print("-" * 60)
            for col in df.columns:
                val = row[col]
                # Show if empty
                if pd.isna(val):
                    val_display = "<<< EMPTY (NaN) >>>"
                elif str(val).strip() == "":
                    val_display = "<<< EMPTY (blank) >>>"
                else:
                    val_display = str(val)[:100]  # Truncate long values
                print(f"  {col}: {val_display}")
            print("\n")
    else:
        print(f"‚ùå No rows found with incident_number containing '{search_value}'")
else:
    print("‚ùå 'incident_number' column not found")

# Also search in ALL columns
print("\n" + "=" * 80)
print(f"üîç Searching '{search_value}' in ALL columns...")

found_in_cols = []
for col in df.columns:
    matches = df[df[col].astype(str).str.contains(search_value, case=False, na=False)]
    if len(matches) > 0:
        found_in_cols.append((col, len(matches)))

if found_in_cols:
    print(f"Found in columns:")
    for col, count in found_in_cols:
        print(f"  - {col}: {count} rows")
else:
    print(f"‚ùå '{search_value}' not found in any column")
