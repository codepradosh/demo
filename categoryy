#!/usr/bin/env python3
"""
Debug script - shows raw file contents
"""

import sys

if len(sys.argv) < 2:
    print("Usage: python debug_file.py input.csv")
    sys.exit(1)

input_file = sys.argv[1]

print("=" * 70)
print("ðŸ” DEBUG: RAW FILE ANALYSIS")
print("=" * 70)
print(f"File: {input_file}")

# Read as raw text
with open(input_file, 'r', encoding='utf-8', errors='replace') as f:
    lines = f.readlines()

total_lines = len(lines)
print(f"\nTotal lines in file: {total_lines:,}")

# Show LAST 50 lines (where garbage usually is)
print("\n" + "=" * 50)
print("LAST 50 LINES OF FILE:")
print("=" * 50)
for i, line in enumerate(lines[-50:], start=total_lines-50):
    # Get first field (incident_number)
    first_field = line.split(',')[0][:60]
    print(f"Line {i}: '{first_field}'")

# Count lines NOT starting with INC (excluding header)
print("\n" + "=" * 50)
print("LINES NOT STARTING WITH 'INC':")
print("=" * 50)
non_inc_count = 0
non_inc_examples = []
for i, line in enumerate(lines[1:], start=1):  # Skip header
    first_field = line.split(',')[0].strip()
    if not first_field.startswith('INC'):
        non_inc_count += 1
        if len(non_inc_examples) < 30:
            non_inc_examples.append(f"Line {i}: '{first_field[:50]}'")

print(f"Count: {non_inc_count}")
if non_inc_examples:
    print("\nExamples:")
    for ex in non_inc_examples:
        print(f"   {ex}")

# Also check for blank first fields
print("\n" + "=" * 50)
print("LINES WITH BLANK/EMPTY FIRST FIELD:")
print("=" * 50)
blank_count = 0
for i, line in enumerate(lines[1:], start=1):
    first_field = line.split(',')[0].strip()
    if first_field == '' or first_field.lower() == 'nan':
        blank_count += 1
        if blank_count <= 10:
            print(f"   Line {i}: entire line = '{line[:100]}'")

print(f"\nTotal blank first fields: {blank_count}")
