#!/usr/bin/env python3
"""
AGGRESSIVE CSV Cleaner
Keeps ONLY rows where incident_number starts with 'INC'
"""

import pandas as pd
import sys

if len(sys.argv) < 3:
    print("Usage: python clean_csv.py input.csv output.csv")
    sys.exit(1)

input_file = sys.argv[1]
output_file = sys.argv[2]

print("=" * 60)
print("ðŸ§¹ AGGRESSIVE CSV CLEANER")
print("=" * 60)
print(f"Input:  {input_file}")
print(f"Output: {output_file}")

# Load CSV
print("\nðŸ“– Loading CSV...")
df = pd.read_csv(input_file, low_memory=False)
initial_rows = len(df)
print(f"   Loaded {initial_rows:,} rows")

# Show sample of incident_number values
print(f"\nðŸ” Sample incident_number values:")
print(f"   First 5: {df['incident_number'].head(5).tolist()}")
print(f"   Last 5:  {df['incident_number'].tail(5).tolist()}")

# FILTER: Keep ONLY rows where incident_number starts with 'INC'
print(f"\nðŸ” Filtering: Keep only rows where incident_number starts with 'INC'...")

def is_valid(val):
    if pd.isna(val):
        return False
    return str(val).strip().startswith('INC')

# Count invalid BEFORE filtering
invalid_count = (~df['incident_number'].apply(is_valid)).sum()
print(f"   Found {invalid_count:,} INVALID rows (don't start with 'INC')")

# Show examples of invalid rows
invalid_rows = df[~df['incident_number'].apply(is_valid)]
if len(invalid_rows) > 0:
    print(f"   Examples of invalid incident_numbers:")
    for val in invalid_rows['incident_number'].head(10).tolist():
        print(f"      - {str(val)[:80]}...")

# KEEP only valid rows
df_clean = df[df['incident_number'].apply(is_valid)].copy()

print(f"\nâœ… Kept {len(df_clean):,} valid rows")
print(f"   Removed {initial_rows - len(df_clean):,} garbage rows")

# Save
print(f"\nðŸ’¾ Saving to {output_file}...")
df_clean.to_csv(output_file, index=False)

print("\n" + "=" * 60)
print("ðŸ“Š SUMMARY")
print("=" * 60)
print(f"   Original:  {initial_rows:,}")
print(f"   Removed:   {initial_rows - len(df_clean):,}")
print(f"   Final:     {len(df_clean):,}")
print("âœ… DONE!")
