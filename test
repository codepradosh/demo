export interface ChatMessage {
  role: "user" | "assistant";
  content: string;
  timestamp?: Date;
}

function downloadCSV(csvContent: string, filename: string) {
  const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
  const url = URL.createObjectURL(blob);
  
  const link = document.createElement("a");
  link.href = url;
  link.download = filename;
  link.click();
  
  URL.revokeObjectURL(url);
}

export function exportToCSV(data: string[][], filename: string = "export.csv") {
  const csvContent = data.map(row => 
    row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(",")
  ).join("\n");
  downloadCSV(csvContent, filename);
}

export function exportObjectToCSV(data: Record<string, unknown> | Record<string, unknown>[], filename: string = "export.csv") {
  const dataArray = Array.isArray(data) ? data : [data];
  if (dataArray.length === 0) return;
  
  const headers = Object.keys(dataArray[0]);
  const rows = dataArray.map(obj => headers.map(h => String(obj[h] ?? "")));
  
  exportToCSV([headers, ...rows], filename);
}

export function exportTextToCSV(text: string, filename: string = "export.csv") {
  downloadCSV(text, filename);
}

export function exportChatToCSV(messages: ChatMessage[], filename: string = "chat-history.csv") {
  const headers = ["Role", "Content", "Timestamp"];
  
  const rows = messages.map(msg => [
    msg.role,
    msg.content,
    msg.timestamp ? msg.timestamp.toISOString() : ""
  ]);

  exportToCSV([headers, ...rows], filename);
}
